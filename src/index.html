<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Squad chat</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    <link rel="stylesheet" href="style.css">
    <script src="/socket.io/socket.io.js"></script>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <script>
      var socket = io();
    </script>
  </head>
  <body>
    <div>
        <h1>Chat app</h1>
    </div>
    <div id="map"></div>
    <ul id="messages"></ul>
    <form id="form" action="">
      <input id="input" autocomplete="off" /><button>Send</button>
    </form>

    <script>
      var map = L.map('map').setView([24.82550280743109, 93.94729035080819], 13);
      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    var circle = L.circle([24.82550280743109, 93.94729035080819], {
    color: 'red',
    fillColor: '#f03',
    fillOpacity: 0.5,
    radius: 200
}).addTo(map);

    var marker = L.marker([24.82311926833569, 93.94407255714167]).addTo(map);
    var polygon = L.polygon([
    [24.82288887257737, 93.94744524421151],
    [24.822840184582795, 93.94557306236575],
    [24.822163419476652, 93.94657620851233]
]).addTo(map);

marker.bindPopup("<b>Hello world!</b><br>I am a popup.").openPopup();
circle.bindPopup("I am a circle.");
polygon.bindPopup("I am a polygon.");

var popup = L.popup();

function onMapClick(e) {
    popup
        .setLatLng(e.latlng)
        .setContent("You clicked the map at " + e.latlng.toString())
        .openOn(map);
}

map.on('click', onMapClick);

map.locate({setView: true, maxZoom: 16});
function onLocationFound(e) {
    var radius = e.accuracy;
    console.log(e.latlng, "this is tthe latlang")
    L.marker(e.latlng).addTo(map)
        .bindPopup("You are within " + radius + " meters from this point").openPopup();

    L.circle(e.latlng, radius).addTo(map);
}

map.on('locationfound', onLocationFound);
// error handling
function onLocationError(e) {
    alert(e.message);
}

map.on('locationerror', onLocationError);

// geo location
const successCallback = (position) => {
  console.log(position, "positon from api");
  
};

const errorCallback = (error) => {
  console.log(error);
};

const options = {
  enableHighAccuracy: true,
  timeout: 10000,
};

var apicircle = L.circle([24.820680798745876, 93.94873633420559], {
    color: 'green',
    fillColor: 'aqua',
    fillOpacity: 0.5,
    radius: 100
}).addTo(map);

navigator.geolocation.getCurrentPosition(successCallback, errorCallback, options);

const id = navigator.geolocation.watchPosition(successCallback, errorCallback);
console.log(id, "this is the id from watch location")
      var form = document.getElementById('form');
      var input = document.getElementById('input');
      var messages = document.getElementById('messages');


      form.addEventListener('submit', function(e) {
        e.preventDefault();
        if (input.value) {
          socket.emit('chat message', input.value);
          input.value = '';
        }
      });

      socket.on('chat message', function(msg) {
        var item = document.createElement('li');
        item.textContent = msg;
        messages.appendChild(item);
        window.scrollTo(0, document.body.scrollHeight);
      });
    </script>
  </body>
</html>